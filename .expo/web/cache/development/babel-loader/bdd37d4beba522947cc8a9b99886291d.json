{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/raj/Desktop/skrt/src/pages/Cart.js\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { StatusBar } from 'expo-status-bar';\nimport React, { useState, useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport TouchableHighlight from \"react-native-web/dist/exports/TouchableHighlight\";\nimport { SwipeListView } from 'react-native-swipe-list-view';\nimport InputSpinner from \"react-native-input-spinner\";\nimport visa_icon from \"../../assets/visa.png\";\nimport mastercard_icon from \"../../assets/mastercard.png\";\nimport amex_icon from \"../../assets/amex.png\";\nimport add_card from \"../../assets/addcard.png\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport CryptoES from \"crypto-es\";\nimport { useFocusEffect } from '@react-navigation/native';\nimport firebase from 'firebase/app';\nimport \"firebase/auth\";\nimport \"firebase/database\";\nimport \"firebase/firestore\";\nimport \"firebase/functions\";\nimport \"firebase/storage\";\nvar firebaseConfig = {\n  apiKey: 'AIzaSyA5CjNAoW1M_HohYvAM-ZLaXTzCOQEo06k',\n  authDomain: 'skrt-3dda3.firebaseapp.com',\n  databaseURL: 'https://skrt-3dda3-default-rtdb.firebaseio.com',\n  projectId: 'skrt-3dda3',\n  storageBucket: 'skrt-3dda3.appspot.com',\n  messagingSenderId: '717588843701',\n  appId: 'app-id'\n};\nfirebase.initializeApp(firebaseConfig);\nvar database = firebase.database();\n\nvar ScreenContainer = function ScreenContainer(_ref) {\n  var children = _ref.children;\n  return React.createElement(View, {\n    style: styles.container_2,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 5\n    }\n  }, children);\n};\n\nvar quantity_states = [];\nvar global_cart;\nvar cardMap = new Map([['visa', 'us_visa_card'], ['mastercard', 'us_mastercard_card'], ['american-express', 'in_amex_card']]);\n\nfunction getIcon(cardType) {\n  if (cardType == null) {\n    return add_card;\n  } else {\n    cardType = cardType.brand;\n  }\n\n  if (cardType == 'visa') {\n    return visa_icon;\n  } else if (cardType == 'american-express') {\n    return amex_icon;\n  } else if (cardType == 'mastercard') {\n    return mastercard_icon;\n  } else if (cardType == null) {\n    return add_card;\n  }\n}\n\nvar getData = function getData(key) {\n  var jsonValue;\n  return _regeneratorRuntime.async(function getData$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(AsyncStorage.getItem(key));\n\n        case 3:\n          jsonValue = _context.sent;\n          console.log(jsonValue != null ? JSON.parse(jsonValue) : null);\n          return _context.abrupt(\"return\", jsonValue != null ? JSON.parse(jsonValue) : null);\n\n        case 8:\n          _context.prev = 8;\n          _context.t0 = _context[\"catch\"](0);\n          alert('Something went wrong reading your cart, please restart the app.');\n\n        case 11:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 8]], Promise);\n};\n\nvar fetchAllItems = function fetchAllItems() {\n  var keys, items, cart_listData, total, element, i, itemDetails;\n  return _regeneratorRuntime.async(function fetchAllItems$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          console.log(\"fetchAllItems called\");\n          _context2.next = 4;\n          return _regeneratorRuntime.awrap(AsyncStorage.getAllKeys());\n\n        case 4:\n          keys = _context2.sent;\n          _context2.next = 7;\n          return _regeneratorRuntime.awrap(AsyncStorage.multiGet(keys));\n\n        case 7:\n          items = _context2.sent;\n          cart_listData = [];\n          total = 0;\n          i = 0;\n\n        case 11:\n          if (!(i < items.length)) {\n            _context2.next = 23;\n            break;\n          }\n\n          if (!isNaN(keys[i])) {\n            _context2.next = 14;\n            break;\n          }\n\n          return _context2.abrupt(\"continue\", 20);\n\n        case 14:\n          element = items[i];\n          itemDetails = JSON.parse(element[1]);\n          console.log(itemDetails);\n          quantity_states[i][1](itemDetails.quantity);\n          cart_listData.push({\n            \"key\": i.toString(),\n            \"barcode\": element[0],\n            \"text\": itemDetails.name,\n            \"quantity\": quantity_states[i][0],\n            \"price\": itemDetails.price\n          });\n          total += quantity_states[i][0] * itemDetails.price;\n\n        case 20:\n          i++;\n          _context2.next = 11;\n          break;\n\n        case 23:\n          global_cart = cart_listData;\n          return _context2.abrupt(\"return\", [cart_listData, total]);\n\n        case 27:\n          _context2.prev = 27;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.log(_context2.t0, \"problemo\");\n\n        case 30:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[0, 27]], Promise);\n};\n\nvar updateQuantity = function updateQuantity(barcode, name, price, quantity) {\n  var jsonValue;\n  return _regeneratorRuntime.async(function updateQuantity$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          jsonValue = {\n            \"name\": name,\n            \"price\": price,\n            \"quantity\": quantity\n          };\n          _context3.next = 4;\n          return _regeneratorRuntime.awrap(AsyncStorage.setItem(barcode, JSON.stringify(jsonValue)));\n\n        case 4:\n          _context3.next = 9;\n          break;\n\n        case 6:\n          _context3.prev = 6;\n          _context3.t0 = _context3[\"catch\"](0);\n          alert('Something went wrong saving your cart, please try again!');\n\n        case 9:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, null, null, [[0, 6]], Promise);\n};\n\nexport var Cart = function Cart(_ref2) {\n  var navigation = _ref2.navigation;\n\n  var _useState = useState(0),\n      _useState2 = _slicedToArray(_useState, 2),\n      totalState = _useState2[0],\n      setTotalState = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      listData = _useState4[0],\n      setListData = _useState4[1];\n\n  var _useState5 = useState({}),\n      _useState6 = _slicedToArray(_useState5, 2),\n      cardState = _useState6[0],\n      setCardState = _useState6[1];\n\n  for (var i = 0; i < 20; i++) {\n    var startingQuantity = 0;\n\n    if (i < listData.length - 1) {\n      startingQuantity = listData[i].quantity;\n    }\n\n    quantity_states.push([]);\n\n    var _useState7 = useState(1);\n\n    var _useState8 = _slicedToArray(_useState7, 2);\n\n    quantity_states[i][0] = _useState8[0];\n    quantity_states[i][1] = _useState8[1];\n  }\n\n  useFocusEffect(React.useCallback(function () {\n    console.log(\"focused\");\n\n    function updateList() {\n      var _await$fetchAllItems, _await$fetchAllItems2, fetched_data, total, currCard;\n\n      return _regeneratorRuntime.async(function updateList$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(fetchAllItems());\n\n            case 2:\n              _await$fetchAllItems = _context4.sent;\n              _await$fetchAllItems2 = _slicedToArray(_await$fetchAllItems, 2);\n              fetched_data = _await$fetchAllItems2[0];\n              total = _await$fetchAllItems2[1];\n              _context4.next = 8;\n              return _regeneratorRuntime.awrap(getData(\"@current_card\"));\n\n            case 8:\n              currCard = _context4.sent;\n              console.log(currCard);\n              setCardState(currCard);\n              setListData(fetched_data);\n              setTotalState(total);\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n\n    updateList();\n  }, []));\n\n  var handleCheckout = function handleCheckout() {\n    if (cardState == null) {\n      alert(\"Please add a payment method to check out!\");\n      return;\n    }\n\n    writeCartToDatabase(global_cart);\n    var http_method = 'post';\n    var url_path = '/v1/payments';\n    var salt = CryptoES.lib.WordArray.random(12);\n    var timestamp = (Math.floor(new Date().getTime() / 1000) - 10).toString();\n    var access_key = '8E34CFD95D661EF7946E';\n    var secret_key = '5001ae0c57b14924dc361c69d2873c93246f9a22e26168ec514dfcaaa35e853bcd9c72c28dbca3c7';\n    var body = JSON.stringify({\n      \"amount\": totalState,\n      \"currency\": \"USD\",\n      \"payment_method\": {\n        \"type\": cardMap.get(cardState.brand),\n        \"fields\": {\n          \"number\": cardState.fullNumber.replace(/\\s/g, ''),\n          \"expiration_month\": cardState.expiration.substr(0, 2),\n          \"expiration_year\": cardState.expiration.substr(3),\n          \"name\": cardState.holder,\n          \"cvv\": cardState.cvv\n        },\n        \"metadata\": {\n          \"merchant_defined\": true\n        }\n      },\n      \"ewallets\": [{\n        \"ewallet\": \"ewallet_8bf64b61b3133ff3076877c05d3d0d68\",\n        \"percentage\": 100\n      }],\n      \"capture\": true\n    });\n    console.log(body);\n    var to_sign = http_method + url_path + salt + timestamp + access_key + secret_key + body;\n    var signature = CryptoES.enc.Hex.stringify(CryptoES.HmacSHA256(to_sign, secret_key));\n    signature = CryptoES.enc.Base64.stringify(CryptoES.enc.Utf8.parse(signature));\n    var options = {\n      'method': 'POST',\n      'url': 'https://sandboxapi.rapyd.net/v1/payments',\n      \"body\": body,\n      'headers': {\n        'Content-Type': 'application/json',\n        'access_key': access_key,\n        'salt': salt,\n        'timestamp': timestamp,\n        'signature': signature\n      }\n    };\n    fetch(\"https://sandboxapi.rapyd.net/v1/payments\", options).then(function (response) {\n      return response.text();\n    }).then(function (result) {\n      return console.log(result);\n    }).catch(function (error) {\n      return console.log('error', error);\n    });\n\n    for (var i = 0; i < listData.length; i++) {\n      AsyncStorage.removeItem(listData[i].barcode);\n    }\n\n    navigation.navigate(\"Confirmation\");\n  };\n\n  var closeRow = function closeRow(rowMap, rowKey) {\n    if (rowMap[rowKey]) {\n      rowMap[rowKey].closeRow();\n    }\n  };\n\n  var deleteRow = function deleteRow(rowMap, rowKey) {\n    closeRow(rowMap, rowKey);\n\n    var newData = _toConsumableArray(listData);\n\n    var prevIndex = listData.findIndex(function (item) {\n      return item.key === rowKey;\n    });\n    console.log(listData[prevIndex]);\n    console.log(\"old total \", totalState, \"subtracting\", listData[prevIndex].price * quantity_states[prevIndex][0]);\n    var newTotal = totalState - listData[prevIndex].price * quantity_states[prevIndex][0];\n    newTotal = Math.round(newTotal * 100) / 100;\n    setTotalState(newTotal);\n    AsyncStorage.removeItem(listData[prevIndex].barcode);\n    newData.splice(prevIndex, 1);\n    setListData(newData);\n  };\n\n  var onRowDidOpen = function onRowDidOpen(rowKey) {\n    console.log('This row opened', rowKey);\n  };\n\n  var renderItem = function renderItem(data) {\n    return React.createElement(TouchableHighlight, {\n      onPress: function onPress() {\n        return console.log('You touched me');\n      },\n      style: styles.rowFront,\n      underlayColor: '#AAA',\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 9\n      }\n    }, React.createElement(View, {\n      style: {\n        flexDirection: \"row\",\n        paddingLeft: 10\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 11\n      }\n    }, React.createElement(View, {\n      style: {\n        flex: 1,\n        justifyContent: \"center\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 15\n      }\n    }, React.createElement(Text, {\n      style: {\n        fontSize: 20\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 17\n      }\n    }, data.item.text)), React.createElement(View, {\n      style: {\n        flex: 0.9,\n        justifyContent: \"center\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 15\n      }\n    }, React.createElement(InputSpinner, {\n      min: 1,\n      step: 1,\n      skin: \"paper\",\n      style: {\n        width: \"80%\"\n      },\n      colorMax: \"#f04048\",\n      colorMin: \"#40c5f4\",\n      editable: false,\n      fontSize: 25,\n      value: quantity_states[data.item.key][0],\n      onChange: function onChange(num) {\n        quantity_states[data.item.key][1](num);\n        updateQuantity(data.item.barcode, data.item.text, data.item.price, num);\n      },\n      onIncrease: function onIncrease(increased) {\n        var newTotal = totalState + parseFloat(data.item.price);\n        newTotal = Math.round(newTotal * 100) / 100;\n        setTotalState(newTotal);\n        console.log(\"new total \" + newTotal);\n      },\n      onDecrease: function onDecrease(decreased) {\n        var newTotal = totalState - parseFloat(data.item.price);\n        newTotal = Math.round(newTotal * 100) / 100;\n        setTotalState(newTotal);\n        console.log(\"new total \" + newTotal);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 17\n      }\n    })), React.createElement(View, {\n      style: {\n        flex: 0.5,\n        justifyContent: \"center\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 15\n      }\n    }, React.createElement(Text, {\n      style: {\n        fontWeight: \"bold\",\n        fontSize: 20\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 19\n      }\n    }, \"$\" + (Math.round(data.item.price * quantity_states[data.item.key][0] * 100) / 100).toFixed(2)))));\n  };\n\n  var renderHiddenItem = function renderHiddenItem(data, rowMap) {\n    return React.createElement(View, {\n      style: styles.rowBack,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 7\n      }\n    }, React.createElement(Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 336,\n        columnNumber: 11\n      }\n    }, \"Left\"), React.createElement(TouchableOpacity, {\n      style: [styles.backRightBtn, styles.backRightBtnLeft],\n      onPress: function onPress() {\n        return closeRow(rowMap, data.item.key);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 11\n      }\n    }, React.createElement(Text, {\n      style: styles.backTextWhite,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 15\n      }\n    }, \"Close\")), React.createElement(TouchableOpacity, {\n      style: [styles.backRightBtn, styles.backRightBtnRight],\n      onPress: function onPress() {\n        return deleteRow(rowMap, data.item.key);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 11\n      }\n    }, React.createElement(Text, {\n      style: styles.backTextWhite,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 15\n      }\n    }, \"Delete\")));\n  };\n\n  var getDoubleHeight = function getDoubleHeight() {\n    return 2 * StatusBar.currentHeight;\n  };\n\n  return React.createElement(ScreenContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 7\n    }\n  }, React.createElement(View, {\n    style: {\n      flex: 10,\n      paddingTop: 40\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 11\n    }\n  }, React.createElement(SwipeListView, {\n    data: listData,\n    renderItem: renderItem,\n    renderHiddenItem: renderHiddenItem,\n    leftOpenValue: 75,\n    rightOpenValue: -150,\n    previewRowKey: '0',\n    previewOpenValue: -40,\n    previewOpenDelay: 3000,\n    onRowDidOpen: onRowDidOpen,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 13\n    }\n  })), React.createElement(View, {\n    style: {\n      flex: 1,\n      justifyContent: 'flex-end',\n      flexDirection: \"row\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 11\n    }\n  }, React.createElement(TouchableOpacity, {\n    style: {\n      flex: 0.25,\n      height: \"100%\",\n      backgroundColor: '#338BA8',\n      alignItems: 'center',\n      justifyContent: 'center'\n    },\n    onPress: function onPress() {\n      navigation.navigate(\"Payment\");\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 15\n    }\n  }, React.createElement(Image, {\n    source: getIcon(cardState),\n    style: {\n      width: \"40%\",\n      height: \"40%\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 19\n    }\n  })), React.createElement(TouchableOpacity, {\n    style: {\n      flex: 0.75,\n      height: \"100%\",\n      backgroundColor: '#1cb51c',\n      alignItems: 'center',\n      justifyContent: 'center'\n    },\n    onPress: handleCheckout,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: {\n      color: 'white',\n      fontSize: 16\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 17\n    }\n  }, \"Checkout - \", React.createElement(Text, {\n    style: {\n      fontWeight: \"bold\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 73\n    }\n  }, \"$\" + totalState.toFixed(2))))));\n};\n\nfunction writeCartToDatabase(cart) {\n  global.orderid = Math.round(Math.random() * 10000000);\n  global.orderid = global.orderid.toString();\n  database.ref('orders/' + global.orderid).set({\n    cart: cart\n  });\n}\n\n;\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: \"#fff\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  container_2: {\n    flex: 1,\n    backgroundColor: \"#fff\"\n  },\n  backTextWhite: {\n    color: '#FFF',\n    fontSize: 20\n  },\n  rowFront: {\n    alignItems: 'center',\n    backgroundColor: '#FFF',\n    borderBottomColor: 'black',\n    borderBottomWidth: 1,\n    justifyContent: 'center',\n    height: 100\n  },\n  rowBack: {\n    alignItems: 'center',\n    backgroundColor: '#DDD',\n    flex: 1,\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    paddingLeft: 15\n  },\n  backRightBtn: {\n    alignItems: 'center',\n    bottom: 0,\n    justifyContent: 'center',\n    position: 'absolute',\n    top: 0,\n    width: 75\n  },\n  backRightBtnLeft: {\n    backgroundColor: 'black',\n    right: 75\n  },\n  backRightBtnRight: {\n    backgroundColor: 'red',\n    right: 0\n  }\n});","map":{"version":3,"sources":["/Users/raj/Desktop/skrt/src/pages/Cart.js"],"names":["StatusBar","React","useState","useEffect","SwipeListView","InputSpinner","visa_icon","mastercard_icon","amex_icon","add_card","AsyncStorage","CryptoES","useFocusEffect","firebase","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","initializeApp","database","ScreenContainer","children","styles","container_2","quantity_states","global_cart","cardMap","Map","getIcon","cardType","brand","getData","key","getItem","jsonValue","console","log","JSON","parse","alert","fetchAllItems","getAllKeys","keys","multiGet","items","cart_listData","total","i","length","isNaN","element","itemDetails","quantity","push","toString","name","price","updateQuantity","barcode","setItem","stringify","Cart","navigation","totalState","setTotalState","listData","setListData","cardState","setCardState","startingQuantity","useCallback","updateList","fetched_data","currCard","handleCheckout","writeCartToDatabase","http_method","url_path","salt","lib","WordArray","random","timestamp","Math","floor","Date","getTime","access_key","secret_key","body","get","fullNumber","replace","expiration","substr","holder","cvv","to_sign","signature","enc","Hex","HmacSHA256","Base64","Utf8","options","fetch","then","response","text","result","catch","error","removeItem","navigate","closeRow","rowMap","rowKey","deleteRow","newData","prevIndex","findIndex","item","newTotal","round","splice","onRowDidOpen","renderItem","data","rowFront","flexDirection","paddingLeft","flex","justifyContent","fontSize","width","num","increased","parseFloat","decreased","fontWeight","toFixed","renderHiddenItem","rowBack","backRightBtn","backRightBtnLeft","backTextWhite","backRightBtnRight","getDoubleHeight","currentHeight","paddingTop","height","backgroundColor","alignItems","color","cart","global","orderid","ref","set","StyleSheet","create","container","borderBottomColor","borderBottomWidth","bottom","position","top","right"],"mappings":";;;;;;;AAAA,SAASA,SAAT,QAA0B,iBAA1B;AACA,OAAOC,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;;;;;;;;;;AAYA,SAASC,aAAT,QAA8B,8BAA9B;AACA,OAAOC,YAAP,MAAyB,4BAAzB;AAEA,OAAOC,SAAP;AACA,OAAOC,eAAP;AACA,OAAOC,SAAP;AACA,OAAOC,QAAP;AAGA,OAAOC,YAAP,MAAyB,2CAAzB;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,SAASC,cAAT,QAA+B,0BAA/B;AACA,OAAOC,QAAP,MAAqB,cAArB;AAGA,OAAO,eAAP;AACA,OAAO,mBAAP;AACA,OAAO,oBAAP;AACA,OAAO,oBAAP;AACA,OAAO,kBAAP;AAGA,IAAMC,cAAc,GAAG;AACnBC,EAAAA,MAAM,EAAE,yCADW;AAEnBC,EAAAA,UAAU,EAAE,4BAFO;AAGnBC,EAAAA,WAAW,EAAE,gDAHM;AAInBC,EAAAA,SAAS,EAAE,YAJQ;AAKnBC,EAAAA,aAAa,EAAE,wBALI;AAMnBC,EAAAA,iBAAiB,EAAE,cANA;AAOnBC,EAAAA,KAAK,EAAE;AAPY,CAAvB;AAUAR,QAAQ,CAACS,aAAT,CAAuBR,cAAvB;AACA,IAAIS,QAAQ,GAAGV,QAAQ,CAACU,QAAT,EAAf;;AAGA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB;AAAA,MAAGC,QAAH,QAAGA,QAAH;AAAA,SACpB,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAIC,MAAM,CAACC,WAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAoCF,QAApC,CADoB;AAAA,CAAxB;;AAIA,IAAIG,eAAe,GAAG,EAAtB;AACA,IAAIC,WAAJ;AAGA,IAAIC,OAAO,GAAG,IAAIC,GAAJ,CAAQ,CAClB,CAAC,MAAD,EAAQ,cAAR,CADkB,EAElB,CAAC,YAAD,EAAe,oBAAf,CAFkB,EAGlB,CAAC,kBAAD,EAAqB,cAArB,CAHkB,CAAR,CAAd;;AAMA,SAASC,OAAT,CAAiBC,QAAjB,EAA2B;AAEzB,MAAIA,QAAQ,IAAI,IAAhB,EAAsB;AACpB,WAAOxB,QAAP;AACD,GAFD,MAEO;AACLwB,IAAAA,QAAQ,GAAGA,QAAQ,CAACC,KAApB;AACD;;AAED,MAAID,QAAQ,IAAI,MAAhB,EAAwB;AACtB,WAAO3B,SAAP;AACD,GAFD,MAEO,IAAI2B,QAAQ,IAAI,kBAAhB,EAAmC;AACxC,WAAOzB,SAAP;AACD,GAFM,MAEA,IAAIyB,QAAQ,IAAI,YAAhB,EAA8B;AACnC,WAAO1B,eAAP;AACD,GAFM,MAEA,IAAI0B,QAAQ,IAAI,IAAhB,EAAsB;AAC3B,WAAOxB,QAAP;AACD;AACF;;AAED,IAAM0B,OAAO,GAAG,SAAVA,OAAU,CAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CAEY1B,YAAY,CAAC2B,OAAb,CAAqBD,GAArB,CAFZ;;AAAA;AAENE,UAAAA,SAFM;AAGZC,UAAAA,OAAO,CAACC,GAAR,CAAYF,SAAS,IAAI,IAAb,GAAoBG,IAAI,CAACC,KAAL,CAAWJ,SAAX,CAApB,GAA4C,IAAxD;AAHY,2CAILA,SAAS,IAAI,IAAb,GAAoBG,IAAI,CAACC,KAAL,CAAWJ,SAAX,CAApB,GAA4C,IAJvC;;AAAA;AAAA;AAAA;AAOZK,UAAAA,KAAK,CAAC,iEAAD,CAAL;;AAPY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAhB;;AAWA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEhBL,UAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AAFgB;AAAA,2CAGG9B,YAAY,CAACmC,UAAb,EAHH;;AAAA;AAGVC,UAAAA,IAHU;AAAA;AAAA,2CAIIpC,YAAY,CAACqC,QAAb,CAAsBD,IAAtB,CAJJ;;AAAA;AAIVE,UAAAA,KAJU;AAKZC,UAAAA,aALY,GAKI,EALJ;AAMZC,UAAAA,KANY,GAMJ,CANI;AASPC,UAAAA,CATO,GASH,CATG;;AAAA;AAAA,gBASAA,CAAC,GAAGH,KAAK,CAACI,MATV;AAAA;AAAA;AAAA;;AAAA,eAWVC,KAAK,CAACP,IAAI,CAACK,CAAD,CAAL,CAXK;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAcdG,UAAAA,OAAO,GAAGN,KAAK,CAACG,CAAD,CAAf;AACII,UAAAA,WAfU,GAeId,IAAI,CAACC,KAAL,CAAWY,OAAO,CAAC,CAAD,CAAlB,CAfJ;AAgBdf,UAAAA,OAAO,CAACC,GAAR,CAAYe,WAAZ;AACA3B,UAAAA,eAAe,CAACuB,CAAD,CAAf,CAAmB,CAAnB,EAAsBI,WAAW,CAACC,QAAlC;AACAP,UAAAA,aAAa,CAACQ,IAAd,CAAmB;AACjB,mBAAON,CAAC,CAACO,QAAF,EADU;AAEjB,uBAAWJ,OAAO,CAAC,CAAD,CAFD;AAGjB,oBAAQC,WAAW,CAACI,IAHH;AAIjB,wBAAY/B,eAAe,CAACuB,CAAD,CAAf,CAAmB,CAAnB,CAJK;AAKjB,qBAASI,WAAW,CAACK;AALJ,WAAnB;AAOAV,UAAAA,KAAK,IAAItB,eAAe,CAACuB,CAAD,CAAf,CAAmB,CAAnB,IAAwBI,WAAW,CAACK,KAA7C;;AAzBc;AASkBT,UAAAA,CAAC,EATnB;AAAA;AAAA;;AAAA;AA2BhBtB,UAAAA,WAAW,GAAGoB,aAAd;AA3BgB,4CA4BT,CAACA,aAAD,EAAgBC,KAAhB,CA5BS;;AAAA;AAAA;AAAA;AA8BhBX,UAAAA,OAAO,CAACC,GAAR,eAAmB,UAAnB;;AA9BgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAtB;;AAkCA,IAAMqB,cAAc,GAAG,SAAjBA,cAAiB,CAAOC,OAAP,EAAgBH,IAAhB,EAAsBC,KAAtB,EAA6BJ,QAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEblB,UAAAA,SAFa,GAED;AAChB,oBAAQqB,IADQ;AAEhB,qBAASC,KAFO;AAGhB,wBAAYJ;AAHI,WAFC;AAAA;AAAA,2CAOb9C,YAAY,CAACqD,OAAb,CAAqBD,OAArB,EAA8BrB,IAAI,CAACuB,SAAL,CAAe1B,SAAf,CAA9B,CAPa;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAUnBK,UAAAA,KAAK,CAAC,0DAAD,CAAL;;AAVmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAvB;;AAcA,OAAO,IAAMsB,IAAI,GAAG,SAAPA,IAAO,QAAoB;AAAA,MAAjBC,UAAiB,SAAjBA,UAAiB;;AAEpC,kBAAoChE,QAAQ,CAAC,CAAD,CAA5C;AAAA;AAAA,MAAOiE,UAAP;AAAA,MAAmBC,aAAnB;;AACA,mBAAgClE,QAAQ,CAAC,EAAD,CAAxC;AAAA;AAAA,MAAOmE,QAAP;AAAA,MAAiBC,WAAjB;;AACA,mBAAkCpE,QAAQ,CAAC,EAAD,CAA1C;AAAA;AAAA,MAAOqE,SAAP;AAAA,MAAkBC,YAAlB;;AAEA,OAAK,IAAIrB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,QAAIsB,gBAAgB,GAAG,CAAvB;;AACA,QAAItB,CAAC,GAAGkB,QAAQ,CAACjB,MAAT,GAAgB,CAAxB,EAA2B;AACzBqB,MAAAA,gBAAgB,GAAGJ,QAAQ,CAAClB,CAAD,CAAR,CAAYK,QAA/B;AACD;;AACD5B,IAAAA,eAAe,CAAC6B,IAAhB,CAAqB,EAArB;;AAL2B,qBAMsBvD,QAAQ,CAAC,CAAD,CAN9B;;AAAA;;AAM1B0B,IAAAA,eAAe,CAACuB,CAAD,CAAf,CAAmB,CAAnB,CAN0B;AAMHvB,IAAAA,eAAe,CAACuB,CAAD,CAAf,CAAmB,CAAnB,CANG;AAO5B;;AAEDvC,EAAAA,cAAc,CACZX,KAAK,CAACyE,WAAN,CAAkB,YAAO;AACvBnC,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;;AACA,aAAemC,UAAf;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACsC/B,aAAa,EADnD;;AAAA;AAAA;AAAA;AACSgC,cAAAA,YADT;AACuB1B,cAAAA,KADvB;AAAA;AAAA,+CAEyBf,OAAO,CAAC,eAAD,CAFhC;;AAAA;AAEQ0C,cAAAA,QAFR;AAIEtC,cAAAA,OAAO,CAACC,GAAR,CAAYqC,QAAZ;AACAL,cAAAA,YAAY,CAACK,QAAD,CAAZ;AAEAP,cAAAA,WAAW,CAACM,YAAD,CAAX;AACAR,cAAAA,aAAa,CAAClB,KAAD,CAAb;;AARF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAUAyB,IAAAA,UAAU;AACX,GAbD,EAaG,EAbH,CADY,CAAd;;AAiBF,MAAMG,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAEzB,QAAIP,SAAS,IAAI,IAAjB,EAAuB;AACrB5B,MAAAA,KAAK,CAAC,2CAAD,CAAL;AACA;AACD;;AAEDoC,IAAAA,mBAAmB,CAAClD,WAAD,CAAnB;AACA,QAAImD,WAAW,GAAG,MAAlB;AACA,QAAIC,QAAQ,GAAG,cAAf;AACA,QAAIC,IAAI,GAAGvE,QAAQ,CAACwE,GAAT,CAAaC,SAAb,CAAuBC,MAAvB,CAA8B,EAA9B,CAAX;AACA,QAAIC,SAAS,GAAG,CAACC,IAAI,CAACC,KAAL,CAAW,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,IAAlC,IAA0C,EAA3C,EAA+ChC,QAA/C,EAAhB;AAEA,QAAIiC,UAAU,GAAG,sBAAjB;AACA,QAAIC,UAAU,GAAG,kFAAjB;AAEA,QAAIC,IAAI,GAAGpD,IAAI,CAACuB,SAAL,CAAe;AACxB,gBAAUG,UADc;AAExB,kBAAY,KAFY;AAGxB,wBAAkB;AAChB,gBAAQrC,OAAO,CAACgE,GAAR,CAAYvB,SAAS,CAACrC,KAAtB,CADQ;AAEhB,kBAAU;AACR,oBAAUqC,SAAS,CAACwB,UAAV,CAAqBC,OAArB,CAA6B,KAA7B,EAAoC,EAApC,CADF;AAER,8BAAoBzB,SAAS,CAAC0B,UAAV,CAAqBC,MAArB,CAA4B,CAA5B,EAA+B,CAA/B,CAFZ;AAGR,6BAAmB3B,SAAS,CAAC0B,UAAV,CAAqBC,MAArB,CAA4B,CAA5B,CAHX;AAIR,kBAAQ3B,SAAS,CAAC4B,MAJV;AAKR,iBAAO5B,SAAS,CAAC6B;AALT,SAFM;AAShB,oBAAY;AACV,8BAAoB;AADV;AATI,OAHM;AAgBxB,kBAAY,CACV;AACE,mBAAW,0CADb;AAEE,sBAAc;AAFhB,OADU,CAhBY;AAsBxB,iBAAW;AAtBa,KAAf,CAAX;AAyBA7D,IAAAA,OAAO,CAACC,GAAR,CAAYqD,IAAZ;AAEA,QAAIQ,OAAO,GAAGrB,WAAW,GAAGC,QAAd,GAAyBC,IAAzB,GAAgCI,SAAhC,GAA4CK,UAA5C,GAAyDC,UAAzD,GAAsEC,IAApF;AAEA,QAAIS,SAAS,GAAG3F,QAAQ,CAAC4F,GAAT,CAAaC,GAAb,CAAiBxC,SAAjB,CAA2BrD,QAAQ,CAAC8F,UAAT,CAAoBJ,OAApB,EAA6BT,UAA7B,CAA3B,CAAhB;AAEAU,IAAAA,SAAS,GAAG3F,QAAQ,CAAC4F,GAAT,CAAaG,MAAb,CAAoB1C,SAApB,CAA8BrD,QAAQ,CAAC4F,GAAT,CAAaI,IAAb,CAAkBjE,KAAlB,CAAwB4D,SAAxB,CAA9B,CAAZ;AACA,QAAIM,OAAO,GAAG;AACZ,gBAAU,MADE;AAEZ,aAAO,0CAFK;AAGZ,cAAQf,IAHI;AAIZ,iBAAW;AACT,wBAAgB,kBADP;AAET,sBAAcF,UAFL;AAGT,gBAAQT,IAHC;AAIT,qBAAaI,SAJJ;AAKT,qBAAagB;AALJ;AAJC,KAAd;AAcFO,IAAAA,KAAK,CAAC,0CAAD,EAA6CD,OAA7C,CAAL,CACGE,IADH,CACQ,UAAAC,QAAQ;AAAA,aAAIA,QAAQ,CAACC,IAAT,EAAJ;AAAA,KADhB,EAEGF,IAFH,CAEQ,UAAAG,MAAM;AAAA,aAAI1E,OAAO,CAACC,GAAR,CAAYyE,MAAZ,CAAJ;AAAA,KAFd,EAGGC,KAHH,CAGS,UAAAC,KAAK;AAAA,aAAI5E,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqB2E,KAArB,CAAJ;AAAA,KAHd;;AAKA,SAAK,IAAIhE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkB,QAAQ,CAACjB,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACxCzC,MAAAA,YAAY,CAAC0G,UAAb,CAAwB/C,QAAQ,CAAClB,CAAD,CAAR,CAAYW,OAApC;AACD;;AAEDI,IAAAA,UAAU,CAACmD,QAAX,CAAoB,cAApB;AAED,GAzED;;AA2EA,MAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACC,MAAD,EAASC,MAAT,EAAoB;AACnC,QAAID,MAAM,CAACC,MAAD,CAAV,EAAoB;AAChBD,MAAAA,MAAM,CAACC,MAAD,CAAN,CAAeF,QAAf;AACH;AACF,GAJD;;AAMA,MAAMG,SAAS,GAAG,SAAZA,SAAY,CAACF,MAAD,EAASC,MAAT,EAAoB;AAClCF,IAAAA,QAAQ,CAACC,MAAD,EAASC,MAAT,CAAR;;AACA,QAAME,OAAO,sBAAOrD,QAAP,CAAb;;AACA,QAAMsD,SAAS,GAAGtD,QAAQ,CAACuD,SAAT,CAAmB,UAAAC,IAAI;AAAA,aAAIA,IAAI,CAACzF,GAAL,KAAaoF,MAAjB;AAAA,KAAvB,CAAlB;AACAjF,IAAAA,OAAO,CAACC,GAAR,CAAY6B,QAAQ,CAACsD,SAAD,CAApB;AAEApF,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0B2B,UAA1B,EAAsC,aAAtC,EAAqDE,QAAQ,CAACsD,SAAD,CAAR,CAAoB/D,KAApB,GAA4BhC,eAAe,CAAC+F,SAAD,CAAf,CAA2B,CAA3B,CAAjF;AACA,QAAIG,QAAQ,GAAG3D,UAAU,GAAIE,QAAQ,CAACsD,SAAD,CAAR,CAAoB/D,KAApB,GAA4BhC,eAAe,CAAC+F,SAAD,CAAf,CAA2B,CAA3B,CAAzD;AACAG,IAAAA,QAAQ,GAAGvC,IAAI,CAACwC,KAAL,CAAWD,QAAQ,GAAG,GAAtB,IAA6B,GAAxC;AACA1D,IAAAA,aAAa,CAAC0D,QAAD,CAAb;AAEApH,IAAAA,YAAY,CAAC0G,UAAb,CAAwB/C,QAAQ,CAACsD,SAAD,CAAR,CAAoB7D,OAA5C;AACA4D,IAAAA,OAAO,CAACM,MAAR,CAAeL,SAAf,EAA0B,CAA1B;AAEArD,IAAAA,WAAW,CAACoD,OAAD,CAAX;AAEH,GAhBD;;AAkBA,MAAMO,YAAY,GAAG,SAAfA,YAAe,CAAAT,MAAM,EAAI;AAC3BjF,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BgF,MAA/B;AACH,GAFD;;AAIA,MAAMU,UAAU,GAAG,SAAbA,UAAa,CAAAC,IAAI;AAAA,WACjB,oBAAC,kBAAD;AACI,MAAA,OAAO,EAAE;AAAA,eAAM5F,OAAO,CAACC,GAAR,CAAY,gBAAZ,CAAN;AAAA,OADb;AAEI,MAAA,KAAK,EAAEd,MAAM,CAAC0G,QAFlB;AAGI,MAAA,aAAa,EAAE,MAHnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKE,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE;AAACC,QAAAA,aAAa,EAAE,KAAhB;AAAuBC,QAAAA,WAAW,EAAE;AAApC,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE;AACXC,QAAAA,IAAI,EAAE,CADK;AAEXC,QAAAA,cAAc,EAAE;AAFL,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAIE,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE;AAACC,QAAAA,QAAQ,EAAE;AAAX,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGN,IAAI,CAACN,IAAL,CAAUb,IADb,CAJF,CADJ,EAUI,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE;AAACuB,QAAAA,IAAI,EAAE,GAAP;AAAYC,QAAAA,cAAc,EAAC;AAA3B,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,oBAAC,YAAD;AACE,MAAA,GAAG,EAAE,CADP;AAEE,MAAA,IAAI,EAAE,CAFR;AAGE,MAAA,IAAI,EAAC,OAHP;AAIE,MAAA,KAAK,EAAE;AAACE,QAAAA,KAAK,EAAE;AAAR,OAJT;AAKE,MAAA,QAAQ,EAAE,SALZ;AAME,MAAA,QAAQ,EAAE,SANZ;AAOE,MAAA,QAAQ,EAAE,KAPZ;AAQE,MAAA,QAAQ,EAAE,EARZ;AASE,MAAA,KAAK,EAAE9G,eAAe,CAACuG,IAAI,CAACN,IAAL,CAAUzF,GAAX,CAAf,CAA+B,CAA/B,CATT;AAUE,MAAA,QAAQ,EAAE,kBAACuG,GAAD,EAAS;AACjB/G,QAAAA,eAAe,CAACuG,IAAI,CAACN,IAAL,CAAUzF,GAAX,CAAf,CAA+B,CAA/B,EAAkCuG,GAAlC;AACA9E,QAAAA,cAAc,CAACsE,IAAI,CAACN,IAAL,CAAU/D,OAAX,EAAoBqE,IAAI,CAACN,IAAL,CAAUb,IAA9B,EAAoCmB,IAAI,CAACN,IAAL,CAAUjE,KAA9C,EAAqD+E,GAArD,CAAd;AACD,OAbH;AAcE,MAAA,UAAU,EAAE,oBAACC,SAAD,EAAe;AACzB,YAAId,QAAQ,GAAG3D,UAAU,GAAG0E,UAAU,CAACV,IAAI,CAACN,IAAL,CAAUjE,KAAX,CAAtC;AACAkE,QAAAA,QAAQ,GAAGvC,IAAI,CAACwC,KAAL,CAAWD,QAAQ,GAAG,GAAtB,IAA6B,GAAxC;AACA1D,QAAAA,aAAa,CAAC0D,QAAD,CAAb;AACAvF,QAAAA,OAAO,CAACC,GAAR,CAAY,eAAesF,QAA3B;AACD,OAnBH;AAoBE,MAAA,UAAU,EAAE,oBAACgB,SAAD,EAAe;AACzB,YAAIhB,QAAQ,GAAG3D,UAAU,GAAG0E,UAAU,CAACV,IAAI,CAACN,IAAL,CAAUjE,KAAX,CAAtC;AACAkE,QAAAA,QAAQ,GAAGvC,IAAI,CAACwC,KAAL,CAAWD,QAAQ,GAAG,GAAtB,IAA6B,GAAxC;AACA1D,QAAAA,aAAa,CAAC0D,QAAD,CAAb;AACAvF,QAAAA,OAAO,CAACC,GAAR,CAAY,eAAesF,QAA3B;AACD,OAzBH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAVJ,EAyCI,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE;AACXS,QAAAA,IAAI,EAAE,GADK;AAEXC,QAAAA,cAAc,EAAE;AAFL,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAII,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE;AAACO,QAAAA,UAAU,EAAE,MAAb;AAAqBN,QAAAA,QAAQ,EAAE;AAA/B,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAkD,MAAM,CAAClD,IAAI,CAACwC,KAAL,CAAWI,IAAI,CAACN,IAAL,CAAUjE,KAAV,GAAkBhC,eAAe,CAACuG,IAAI,CAACN,IAAL,CAAUzF,GAAX,CAAf,CAA+B,CAA/B,CAAlB,GAAsD,GAAjE,IAAsE,GAAvE,EAA4E4G,OAA5E,CAAoF,CAApF,CAAxD,CAJJ,CAzCJ,CALF,CADiB;AAAA,GAAvB;;AAyDA,MAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACd,IAAD,EAAOZ,MAAP;AAAA,WACrB,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE7F,MAAM,CAACwH,OAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,EAEI,oBAAC,gBAAD;AACI,MAAA,KAAK,EAAE,CAACxH,MAAM,CAACyH,YAAR,EAAsBzH,MAAM,CAAC0H,gBAA7B,CADX;AAEI,MAAA,OAAO,EAAE;AAAA,eAAM9B,QAAQ,CAACC,MAAD,EAASY,IAAI,CAACN,IAAL,CAAUzF,GAAnB,CAAd;AAAA,OAFb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAII,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAEV,MAAM,CAAC2H,aAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAJJ,CAFJ,EAQI,oBAAC,gBAAD;AACI,MAAA,KAAK,EAAE,CAAC3H,MAAM,CAACyH,YAAR,EAAsBzH,MAAM,CAAC4H,iBAA7B,CADX;AAEI,MAAA,OAAO,EAAE;AAAA,eAAM7B,SAAS,CAACF,MAAD,EAASY,IAAI,CAACN,IAAL,CAAUzF,GAAnB,CAAf;AAAA,OAFb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAII,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAEV,MAAM,CAAC2H,aAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAJJ,CARJ,CADqB;AAAA,GAAzB;;AAkBE,MAAIE,eAAe,GAAG,SAAlBA,eAAkB,GAAU;AAC9B,WAAO,IAAIvJ,SAAS,CAACwJ,aAArB;AACD,GAFD;;AAIA,SACE,oBAAC,eAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,oBAAC,IAAD;AAAM,IAAA,KAAK,EACT;AACEjB,MAAAA,IAAI,EAAE,EADR;AAEEkB,MAAAA,UAAU,EAAE;AAFd,KADF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAME,oBAAC,aAAD;AACI,IAAA,IAAI,EAAEpF,QADV;AAEI,IAAA,UAAU,EAAE6D,UAFhB;AAGI,IAAA,gBAAgB,EAAEe,gBAHtB;AAII,IAAA,aAAa,EAAE,EAJnB;AAKI,IAAA,cAAc,EAAE,CAAC,GALrB;AAMI,IAAA,aAAa,EAAE,GANnB;AAOI,IAAA,gBAAgB,EAAE,CAAC,EAPvB;AAQI,IAAA,gBAAgB,EAAE,IARtB;AASI,IAAA,YAAY,EAAEhB,YATlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IANF,CADJ,EAoBI,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAACM,MAAAA,IAAI,EAAE,CAAP;AAAUC,MAAAA,cAAc,EAAE,UAA1B;AAAsCH,MAAAA,aAAa,EAAC;AAApD,KAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAEI,oBAAC,gBAAD;AACE,IAAA,KAAK,EAAE;AACLE,MAAAA,IAAI,EAAE,IADD;AAELmB,MAAAA,MAAM,EAAE,MAFH;AAGLC,MAAAA,eAAe,EAAE,SAHZ;AAILC,MAAAA,UAAU,EAAE,QAJP;AAKLpB,MAAAA,cAAc,EAAE;AALX,KADT;AAQE,IAAA,OAAO,EAAE,mBAAM;AAACtE,MAAAA,UAAU,CAACmD,QAAX,CAAoB,SAApB;AAA+B,KARjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KASI,oBAAC,KAAD;AAAO,IAAA,MAAM,EAAErF,OAAO,CAACuC,SAAD,CAAtB;AAAmC,IAAA,KAAK,EAAE;AAAEmE,MAAAA,KAAK,EAAE,KAAT;AAAgBgB,MAAAA,MAAM,EAAE;AAAxB,KAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IATJ,CAFJ,EAcI,oBAAC,gBAAD;AACE,IAAA,KAAK,EAAE;AACLnB,MAAAA,IAAI,EAAE,IADD;AAELmB,MAAAA,MAAM,EAAE,MAFH;AAGLC,MAAAA,eAAe,EAAE,SAHZ;AAILC,MAAAA,UAAU,EAAE,QAJP;AAKLpB,MAAAA,cAAc,EAAE;AALX,KADT;AAQE,IAAA,OAAO,EAAE1D,cARX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KASE,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAAC+E,MAAAA,KAAK,EAAE,OAAR;AAAiBpB,MAAAA,QAAQ,EAAE;AAA3B,KAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAwD,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAACM,MAAAA,UAAU,EAAC;AAAZ,KAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAmC,MAAM5E,UAAU,CAAC6E,OAAX,CAAmB,CAAnB,CAAzC,CAAxD,CATF,CAdJ,CApBJ,CADF;AAmDD,CAzQI;;AA2QP,SAASjE,mBAAT,CAA6B+E,IAA7B,EAAmC;AAC/BC,EAAAA,MAAM,CAACC,OAAP,GAAiBzE,IAAI,CAACwC,KAAL,CAAWxC,IAAI,CAACF,MAAL,KAAgB,QAA3B,CAAjB;AACA0E,EAAAA,MAAM,CAACC,OAAP,GAAiBD,MAAM,CAACC,OAAP,CAAetG,QAAf,EAAjB;AACAnC,EAAAA,QAAQ,CAAC0I,GAAT,CAAa,YAAYF,MAAM,CAACC,OAAhC,EAAyCE,GAAzC,CAA6C;AAACJ,IAAAA,IAAI,EAAEA;AAAP,GAA7C;AACH;;AAAA;AAEC,IAAMpI,MAAM,GAAGyI,UAAU,CAACC,MAAX,CAAkB;AAC/BC,EAAAA,SAAS,EAAE;AACT9B,IAAAA,IAAI,EAAE,CADG;AAEToB,IAAAA,eAAe,EAAE,MAFR;AAGTC,IAAAA,UAAU,EAAE,QAHH;AAITpB,IAAAA,cAAc,EAAE;AAJP,GADoB;AAQ/B7G,EAAAA,WAAW,EAAE;AACX4G,IAAAA,IAAI,EAAE,CADK;AAEXoB,IAAAA,eAAe,EAAE;AAFN,GARkB;AAa/BN,EAAAA,aAAa,EAAE;AACbQ,IAAAA,KAAK,EAAE,MADM;AAEbpB,IAAAA,QAAQ,EAAE;AAFG,GAbgB;AAiB/BL,EAAAA,QAAQ,EAAE;AACNwB,IAAAA,UAAU,EAAE,QADN;AAEND,IAAAA,eAAe,EAAE,MAFX;AAGNW,IAAAA,iBAAiB,EAAE,OAHb;AAINC,IAAAA,iBAAiB,EAAE,CAJb;AAKN/B,IAAAA,cAAc,EAAE,QALV;AAMNkB,IAAAA,MAAM,EAAE;AANF,GAjBqB;AAyB/BR,EAAAA,OAAO,EAAE;AACLU,IAAAA,UAAU,EAAE,QADP;AAELD,IAAAA,eAAe,EAAE,MAFZ;AAGLpB,IAAAA,IAAI,EAAE,CAHD;AAILF,IAAAA,aAAa,EAAE,KAJV;AAKLG,IAAAA,cAAc,EAAE,eALX;AAMLF,IAAAA,WAAW,EAAE;AANR,GAzBsB;AAiC/Ba,EAAAA,YAAY,EAAE;AACVS,IAAAA,UAAU,EAAE,QADF;AAEVY,IAAAA,MAAM,EAAE,CAFE;AAGVhC,IAAAA,cAAc,EAAE,QAHN;AAIViC,IAAAA,QAAQ,EAAE,UAJA;AAKVC,IAAAA,GAAG,EAAE,CALK;AAMVhC,IAAAA,KAAK,EAAE;AANG,GAjCiB;AAyC/BU,EAAAA,gBAAgB,EAAE;AACdO,IAAAA,eAAe,EAAE,OADH;AAEdgB,IAAAA,KAAK,EAAE;AAFO,GAzCa;AA6C/BrB,EAAAA,iBAAiB,EAAE;AACfK,IAAAA,eAAe,EAAE,KADF;AAEfgB,IAAAA,KAAK,EAAE;AAFQ;AA7CY,CAAlB,CAAf","sourcesContent":["import { StatusBar } from 'expo-status-bar';\nimport React, { useState, useEffect } from 'react';\nimport {\n  StyleSheet,\n  Text,\n  View,\n  FlatList,\n  Image,\n  TextInput,\n  Button,\n  TouchableOpacity,\n  TouchableHighlight\n} from \"react-native\";\nimport { SwipeListView } from 'react-native-swipe-list-view';\nimport InputSpinner from \"react-native-input-spinner\";\n\nimport visa_icon from '../../assets/visa.png';\nimport mastercard_icon from '../../assets/mastercard.png';\nimport amex_icon from '../../assets/amex.png';\nimport add_card from '../../assets/addcard.png'\n\n\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport CryptoES from \"crypto-es\";\nimport { useFocusEffect } from '@react-navigation/native';\nimport firebase from 'firebase/app'\n\n// Optionally import the services that you want to use\nimport \"firebase/auth\";\nimport \"firebase/database\";\nimport \"firebase/firestore\";\nimport \"firebase/functions\";\nimport \"firebase/storage\";\n\n// Initialize Firebase\nconst firebaseConfig = {\n    apiKey: 'AIzaSyA5CjNAoW1M_HohYvAM-ZLaXTzCOQEo06k',\n    authDomain: 'skrt-3dda3.firebaseapp.com',\n    databaseURL: 'https://skrt-3dda3-default-rtdb.firebaseio.com',\n    projectId: 'skrt-3dda3',\n    storageBucket: 'skrt-3dda3.appspot.com',\n    messagingSenderId: '717588843701',\n    appId: 'app-id',\n};\n\nfirebase.initializeApp(firebaseConfig);\nvar database = firebase.database();\n\n\nconst ScreenContainer = ({ children }) => (\n    <View style = {styles.container_2}>{children}</View>\n)\n\nvar quantity_states = [];\nvar global_cart;\n\n\nlet cardMap = new Map([\n    ['visa','us_visa_card'],\n    ['mastercard', 'us_mastercard_card'],\n    ['american-express', 'in_amex_card']\n]);\n\nfunction getIcon(cardType) {\n\n  if (cardType == null) {\n    return add_card;\n  } else {\n    cardType = cardType.brand;\n  }\n\n  if (cardType == 'visa') {\n    return visa_icon;\n  } else if (cardType == 'american-express'){\n    return amex_icon;\n  } else if (cardType == 'mastercard') {\n    return mastercard_icon;\n  } else if (cardType == null) {\n    return add_card;\n  }\n}\n\nconst getData = async (key) => {\n  try {\n    const jsonValue = await AsyncStorage.getItem(key)\n    console.log(jsonValue != null ? JSON.parse(jsonValue) : null)\n    return jsonValue != null ? JSON.parse(jsonValue) : null;\n  } catch(e) {\n    // error reading value\n    alert('Something went wrong reading your cart, please restart the app.');\n  }\n}\n\nconst fetchAllItems = async () => {\n  try {\n      console.log(\"fetchAllItems called\")\n      const keys = await AsyncStorage.getAllKeys()\n      const items = await AsyncStorage.multiGet(keys)\n      var cart_listData = [];\n      var total = 0;\n\n      var element;\n      for (var i = 0; i < items.length; i++) {\n        //check if element is a barcode\n        if (isNaN(keys[i])) {\n          continue;\n        }\n        element = items[i];\n        var itemDetails = JSON.parse(element[1])\n        console.log(itemDetails)\n        quantity_states[i][1](itemDetails.quantity)\n        cart_listData.push({\n          \"key\": i.toString(),\n          \"barcode\": element[0],\n          \"text\": itemDetails.name,\n          \"quantity\": quantity_states[i][0],\n          \"price\": itemDetails.price\n        })\n        total += quantity_states[i][0] * itemDetails.price;\n      }\n      global_cart = cart_listData;\n      return [cart_listData, total];\n  } catch (error) {\n      console.log(error, \"problemo\")\n  }\n}\n\nconst updateQuantity = async (barcode, name, price, quantity) => {\n  try {\n    const jsonValue = {\n      \"name\": name,\n      \"price\": price,\n      \"quantity\": quantity\n    }\n    await AsyncStorage.setItem(barcode, JSON.stringify(jsonValue))\n  } catch (e) {\n    // saving error\n    alert('Something went wrong saving your cart, please try again!');\n  }\n}\n\nexport const Cart = ({ navigation }) => {\n\n    const [totalState, setTotalState] = useState(0)\n    const [listData, setListData] = useState([]);\n    const [cardState, setCardState] = useState({})\n\n    for (var i = 0; i < 20; i++) {\n      var startingQuantity = 0;\n      if (i < listData.length-1) {\n        startingQuantity = listData[i].quantity;\n      }\n      quantity_states.push([]);\n      [quantity_states[i][0], quantity_states[i][1]] = useState(1);\n    }\n\n    useFocusEffect(\n      React.useCallback(() =>  {\n        console.log(\"focused\")\n        async function updateList(){\n          const [fetched_data, total] = await fetchAllItems();\n          const currCard = await getData(\"@current_card\")\n\n          console.log(currCard);\n          setCardState(currCard);\n\n          setListData(fetched_data);\n          setTotalState(total)\n        }\n        updateList();\n      }, [])\n    );\n\n  const handleCheckout = () => {\n\n      if (cardState == null) {\n        alert(\"Please add a payment method to check out!\")\n        return;\n      }\n\n      writeCartToDatabase(global_cart);\n      var http_method = 'post';                // Lower case.\n      var url_path = '/v1/payments';    // Portion after the base URL.\n      var salt = CryptoES.lib.WordArray.random(12);  // Randomly generated for each request.\n      var timestamp = (Math.floor(new Date().getTime() / 1000) - 10).toString();\n                                              // Current Unix time.\n      var access_key = '8E34CFD95D661EF7946E';     // The access key received from Rapyd.\n      var secret_key = '5001ae0c57b14924dc361c69d2873c93246f9a22e26168ec514dfcaaa35e853bcd9c72c28dbca3c7';     // Never transmit the secret key by itself.\n\n      var body = JSON.stringify({\n        \"amount\": totalState,\n        \"currency\": \"USD\",\n        \"payment_method\": {\n          \"type\": cardMap.get(cardState.brand),\n          \"fields\": {\n            \"number\": cardState.fullNumber.replace(/\\s/g, ''),\n            \"expiration_month\": cardState.expiration.substr(0, 2),\n            \"expiration_year\": cardState.expiration.substr(3),\n            \"name\": cardState.holder,\n            \"cvv\": cardState.cvv\n          },\n          \"metadata\": {\n            \"merchant_defined\": true\n          }\n        },\n        \"ewallets\": [\n          {\n            \"ewallet\": \"ewallet_8bf64b61b3133ff3076877c05d3d0d68\",\n            \"percentage\": 100\n          }\n        ],\n        \"capture\": true\n      });\n\n      console.log(body)\n\n      var to_sign = http_method + url_path + salt + timestamp + access_key + secret_key + body;\n\n      var signature = CryptoES.enc.Hex.stringify(CryptoES.HmacSHA256(to_sign, secret_key));\n\n      signature = CryptoES.enc.Base64.stringify(CryptoES.enc.Utf8.parse(signature));\n      var options = {\n        'method': 'POST',\n        'url': 'https://sandboxapi.rapyd.net/v1/payments',\n        \"body\": body,\n        'headers': {\n          'Content-Type': 'application/json',\n          'access_key': access_key,\n          'salt': salt,\n          'timestamp': timestamp,\n          'signature': signature,\n        }\n      };\n\n\n    fetch(\"https://sandboxapi.rapyd.net/v1/payments\", options)\n      .then(response => response.text())\n      .then(result => console.log(result))\n      .catch(error => console.log('error', error));\n\n    for (var i = 0; i < listData.length; i++) {\n      AsyncStorage.removeItem(listData[i].barcode)\n    }\n\n    navigation.navigate(\"Confirmation\")\n\n  }\n\n  const closeRow = (rowMap, rowKey) => {\n    if (rowMap[rowKey]) {\n        rowMap[rowKey].closeRow();\n    }\n  };\n\n  const deleteRow = (rowMap, rowKey) => {\n      closeRow(rowMap, rowKey);\n      const newData = [...listData];\n      const prevIndex = listData.findIndex(item => item.key === rowKey);\n      console.log(listData[prevIndex])\n\n      console.log(\"old total \", totalState, \"subtracting\", listData[prevIndex].price * quantity_states[prevIndex][0])\n      var newTotal = totalState - (listData[prevIndex].price * quantity_states[prevIndex][0])\n      newTotal = Math.round(newTotal * 100) / 100\n      setTotalState(newTotal)\n\n      AsyncStorage.removeItem(listData[prevIndex].barcode)\n      newData.splice(prevIndex, 1);\n\n      setListData(newData);\n\n  };\n\n  const onRowDidOpen = rowKey => {\n      console.log('This row opened', rowKey);\n  };\n\n  const renderItem = data => (\n        <TouchableHighlight\n            onPress={() => console.log('You touched me')}\n            style={styles.rowFront}\n            underlayColor={'#AAA'}\n        >\n          <View style={{flexDirection: \"row\", paddingLeft: 10}}>\n              <View style={{\n                flex: 1,\n                justifyContent: \"center\"\n              }}>\n                <Text style={{fontSize: 20}}>\n                  {data.item.text}\n                </Text>\n              </View>\n\n              <View style={{flex: 0.9, justifyContent:\"center\"}}>\n                <InputSpinner\n                  min={1}\n                  step={1}\n                  skin=\"paper\"\n                  style={{width: \"80%\"}}\n                  colorMax={\"#f04048\"}\n                  colorMin={\"#40c5f4\"}\n                  editable={false}\n                  fontSize={25}\n                  value={quantity_states[data.item.key][0]}\n                  onChange={(num) => {\n                    quantity_states[data.item.key][1](num);\n                    updateQuantity(data.item.barcode, data.item.text, data.item.price, num)\n                  }}\n                  onIncrease={(increased) => {\n                    var newTotal = totalState + parseFloat(data.item.price)\n                    newTotal = Math.round(newTotal * 100) / 100\n                    setTotalState(newTotal)\n                    console.log(\"new total \" + newTotal)\n                  }}\n                  onDecrease={(decreased) => {\n                    var newTotal = totalState - parseFloat(data.item.price)\n                    newTotal = Math.round(newTotal * 100) / 100\n                    setTotalState(newTotal)\n                    console.log(\"new total \" + newTotal)\n                  }}\n                />\n              </View>\n\n\n              <View style={{\n                flex: 0.5,\n                justifyContent: \"center\"\n              }}>\n                  <Text style={{fontWeight: \"bold\", fontSize: 20}}>{\"$\" + (Math.round(data.item.price * quantity_states[data.item.key][0] * 100)/100).toFixed(2)}</Text>\n              </View>\n          </View>\n        </TouchableHighlight>\n  );\n\n  const renderHiddenItem = (data, rowMap) => (\n      <View style={styles.rowBack}>\n          <Text>Left</Text>\n          <TouchableOpacity\n              style={[styles.backRightBtn, styles.backRightBtnLeft]}\n              onPress={() => closeRow(rowMap, data.item.key)}\n          >\n              <Text style={styles.backTextWhite}>Close</Text>\n          </TouchableOpacity>\n          <TouchableOpacity\n              style={[styles.backRightBtn, styles.backRightBtnRight]}\n              onPress={() => deleteRow(rowMap, data.item.key)}\n          >\n              <Text style={styles.backTextWhite}>Delete</Text>\n          </TouchableOpacity>\n      </View>\n  );\n\n    var getDoubleHeight = function(){\n      return 2 * StatusBar.currentHeight;\n    };\n\n    return (\n      <ScreenContainer>\n          <View style={\n            {\n              flex: 10,\n              paddingTop: 40\n            }\n          }>\n            <SwipeListView\n                data={listData}\n                renderItem={renderItem}\n                renderHiddenItem={renderHiddenItem}\n                leftOpenValue={75}\n                rightOpenValue={-150}\n                previewRowKey={'0'}\n                previewOpenValue={-40}\n                previewOpenDelay={3000}\n                onRowDidOpen={onRowDidOpen}\n            />\n          </View>\n\n          <View style={{flex: 1, justifyContent: 'flex-end', flexDirection:\"row\"}}>\n\n              <TouchableOpacity\n                style={{\n                  flex: 0.25,\n                  height: \"100%\",\n                  backgroundColor: '#338BA8',\n                  alignItems: 'center',\n                  justifyContent: 'center'\n                }}\n                onPress={() => {navigation.navigate(\"Payment\")}}>\n                  <Image source={getIcon(cardState)} style={{ width: \"40%\", height: \"40%\"}} /> \n              </TouchableOpacity>\n\n              <TouchableOpacity\n                style={{\n                  flex: 0.75,\n                  height: \"100%\",\n                  backgroundColor: '#1cb51c',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                }}\n                onPress={handleCheckout}>\n                <Text style={{color: 'white', fontSize: 16}}>Checkout - <Text style={{fontWeight:\"bold\"}}>{\"$\" + totalState.toFixed(2)}</Text></Text>\n              </TouchableOpacity>\n\n          </View>\n\n      </ScreenContainer>\n    );\n  };\n\nfunction writeCartToDatabase(cart) {\n    global.orderid = Math.round(Math.random() * 10000000);\n    global.orderid = global.orderid.toString();\n    database.ref('orders/' + global.orderid).set({cart: cart});\n};\n  \n  const styles = StyleSheet.create({\n    container: {\n      flex: 1,\n      backgroundColor: \"#fff\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n    },\n  \n    container_2: {\n      flex: 1,\n      backgroundColor: \"#fff\"\n    },\n   \n    backTextWhite: {\n      color: '#FFF',\n      fontSize: 20\n    },\n    rowFront: {\n        alignItems: 'center',\n        backgroundColor: '#FFF',\n        borderBottomColor: 'black',\n        borderBottomWidth: 1,\n        justifyContent: 'center',\n        height: 100,\n    },\n    rowBack: {\n        alignItems: 'center',\n        backgroundColor: '#DDD',\n        flex: 1,\n        flexDirection: 'row',\n        justifyContent: 'space-between',\n        paddingLeft: 15,\n    },\n    backRightBtn: {\n        alignItems: 'center',\n        bottom: 0,\n        justifyContent: 'center',\n        position: 'absolute',\n        top: 0,\n        width: 75,\n    },\n    backRightBtnLeft: {\n        backgroundColor: 'black',\n        right: 75,\n    },\n    backRightBtnRight: {\n        backgroundColor: 'red',\n        right: 0,\n    }\n  });\n  "]},"metadata":{},"sourceType":"module"}